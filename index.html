<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Äá»c Dá»… â€“ Há»— trá»£ tráº» rá»‘i loáº¡n Ä‘á»c</title>
  <meta name="description" content="Luyá»‡n Ã¢m vá»‹, tháº» tá»«, Ä‘Ã¡nh giÃ¡ nhanh (screeners), Ä‘á»c trÃ´i cháº£y (WCPM), hiá»ƒu ná»™i dung; TTS, ghi Ã¢m, Voice UI, dashboard, xuáº¥t CSV/PDF, Ä‘á»“ng bá»™ Google Drive." />
  <link id="manifestLink" rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#FFF3D6" />
  <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><rect width='128' height='128' fill='%23FFF3D6'/><text x='50%' y='58%' dominant-baseline='middle' text-anchor='middle' font-size='80' font-family='sans-serif' fill='%23111'>Ä</text></svg>">
  <link rel="stylesheet" href="styles.css" />
  <style>
    :root{
      --token-correct-bg:#E6FFE6;
      --token-correct-bd:#5bbb5b;
      --token-wrong-bg:#FFEAEA;
      --hero-radius:16px;
      --footer-h:62px;
      --bd:#e5e7eb;
    }
    /* TÄƒng kháº£ nÄƒng Ä‘á»c */
    .big-text{ line-height:1.7; letter-spacing:0.02em; word-spacing:0.06em; }
    body.dys .big-text{ letter-spacing:0.04em; word-spacing:0.12em; }
    /* Má»¥c tiÃªu cháº¡m tá»‘i thiá»ƒu */
    button, .ghost, .primary, .tts, .danger, .record, .tog { min-height:44px; min-width:44px; }
    .reading-line span{ padding:1px 2px; border-radius:4px; transition: background .2s, box-shadow .2s, outline .2s, border-bottom-color .2s; }
    .token{ padding:0 2px; border-radius:4px; }
    .token:focus{ outline:3px solid var(--primary, #3c7); outline-offset:2px; }
    .stepper .step{ min-width:44px; }
    .stat b[aria-live]{ display:inline-block; min-width:3ch; }
    .skip-link{ position:absolute; left:-9999px; top:0; }
    .skip-link:focus{ left:8px; top:8px; background:#000; color:#fff; padding:8px 12px; z-index:9999; border-radius:6px; }

    /* Chá»«a Ä‘á»‡m phÃ­a dÆ°á»›i cho thanh Ä‘Ã¡y (Ä‘á»ƒ khÃ´ng che ná»™i dung) */
    .app{ padding-bottom: calc(var(--footer-h) + env(safe-area-inset-bottom, 0px)); }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; scroll-behavior:auto !important; }
    }
    .grid-2 { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
    @media (max-width:700px){ .grid-2{ grid-template-columns: 1fr; } }
    .card.list { padding:10px; border-radius:8px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,.08); }
    .mini-grid-5 { display:grid; grid-template-columns: repeat(5, 1fr); gap:6px; }
    .mini-grid-5 .cell { border:1px solid #ddd; padding:6px; text-align:center; border-radius:4px; background:#fafafa; }

    /* HERO banners (minh há»a SVG) */
    .hero {
      position: relative;
      border-radius: var(--hero-radius);
      overflow: hidden;
      min-height: 160px;
      margin: 10px 0 14px;
      background: linear-gradient(135deg, #FFF3D6, #E8F4FF);
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
    }
    .hero .hero-content{
      position: relative;
      z-index: 2;
      padding: 16px 16px 18px 16px;
      max-width: 65%;
    }
    .hero .hero-title{
      font-size: 20px; font-weight: 700; color:#1a1a1a; margin:0 0 4px;
    }
    .hero .hero-sub{
      font-size: 14px; color:#333; opacity:.9; margin:0;
    }
    .hero .hero-art{
      position:absolute; inset:auto 0 0 auto; right:0; bottom:-4px;
      width: 52%; max-width: 420px; opacity:.95; pointer-events: none;
    }
    /* Biáº¿n thá»ƒ ná»n theo mÃ n */
    .hero.assess{ background: linear-gradient(135deg, #FDF2D7, #E8F6E8); }
    .hero.pa{ background: linear-gradient(135deg, #F2E8FF, #E7F1FF); }
    .hero.cards{ background: linear-gradient(135deg, #E5FBFF, #FFF7E8); }
    .hero.reading{ background: linear-gradient(135deg, #E9F7FF, #FFF0F5); }
    .hero.game{ background: linear-gradient(135deg, #FFF3D6, #E8FFE8); }
    .hero.dashboard{ background: linear-gradient(135deg, #E6F4FF, #F0FFF3); }
    .hero.export{ background: linear-gradient(135deg, #FFF2F0, #EEF7FF); }
    .hero.settings{ background: linear-gradient(135deg, #FFF8E1, #EEF9FF); }
    .hero.home{ background: linear-gradient(135deg, #FFF3D6, #E8F4FF); }

    /* Nháº¹ nhÃ ng tÃ¡ch pháº§n cÃ²n láº¡i */
    .section .hero + *{ margin-top: 4px; }
    .muted{ color:#666; font-size: 0.95em; }

    /* HÃ¬nh trong modal/hÆ°á»›ng dáº«n tá»± co giÃ£n */
    .modal .dialog img,
    .help img,
    .help-illustration,
    .help-step img,
    .hero .hero-art img,
    .hero .hero-art svg { max-width:100%; height:auto; display:block; object-fit:contain; }

    /* Thanh Ä‘Ã¡y: tá»± áº©n khi khÃ´ng dÃ¹ng (trÃ¡nh che ná»™i dung) */
    .footerbar{
      position: fixed; left:0; right:0; bottom:0; z-index:1000;
      display:flex; gap:8px; justify-content:space-around;
      background: rgba(255, 243, 214, .95); backdrop-filter: blur(6px);
      box-shadow: 0 -4px 12px rgba(0,0,0,.06);
      padding: 8px 10px calc(8px + env(safe-area-inset-bottom, 0px)) 10px;
      transition: transform .24s ease;
    }
    .footerbar.hidden{ transform: translateY(110%); pointer-events:none; }
    .footerbar button{ min-width:56px; }

    /* NÃºt thu gá»n/hiá»‡n thanh tiÃªu Ä‘á» (appbar) + thanh há»— trá»£ (a11ybar) */
    .header-toggle,
    .a11y-toggle{
      position: fixed;
      right: 10px;
      z-index: 1100;
      border:1px solid var(--bd);
      background:#fff;
      border-radius:999px;
      padding:8px 10px;
      box-shadow:0 6px 18px rgba(0,0,0,.1);
      font-weight:700;
      cursor:pointer;
    }
    .header-toggle{ top: calc(env(safe-area-inset-top, 0px) + 8px); }
    .a11y-toggle{ top: calc(env(safe-area-inset-top, 0px) + 56px); }
    .appbar.hidden-appbar{ display:none !important; }
    .a11ybar.hidden-a11ybar{ display:none !important; } /* áº¨n thanh Dá»… Ä‘á»c/A-/A+/Con trá» */
  </style>
  <script>
    (function fixManifestPath(){
      try{
        var link = document.getElementById('manifestLink');
        if (!link) return;
        var parts = location.pathname.split('/').filter(Boolean);
        var base = (location.hostname.endsWith('.github.io') && parts.length > 0) ? ('/' + parts[0] + '/') : '/';
        link.setAttribute('href', base + 'manifest.webmanifest');
      }catch(_){}
    })();
  </script>
</head>
<body>
<a href="#screen-reading" class="skip-link">Bá» qua Ä‘á»ƒ tá»›i Luyá»‡n Ä‘á»c</a>

<!-- NÃºt thu gá»n/hiá»‡n thanh tiÃªu Ä‘á» -->
<button id="btnHeaderToggle" class="header-toggle" aria-pressed="false" aria-label="Thu gá»n thanh tiÃªu Ä‘á»">â¬† Thu gá»n</button>
<!-- NÃºt thu gá»n/hiá»‡n thanh há»— trá»£ (Dá»… Ä‘á»c, A-/A+, Con trá») -->
<button id="btnA11yToggle" class="a11y-toggle" aria-pressed="false" aria-label="Thu gá»n thanh há»— trá»£">ğŸ›  Thu gá»n há»— trá»£</button>

<div class="app">
  <header class="appbar">
    <div>
      <div class="title">Äá»c Dá»… <span class="stars" id="starCount">â­ 0</span></div>
      <div class="subtitle">Ã‚m vá»‹ â€¢ Tháº» tá»« â€¢ ÄÃ¡nh giÃ¡ nhanh â€¢ Äá»c trÃ´i cháº£y â€¢ Dashboard</div>
    </div>
    <div class="toolbar">
      <span id="learnerBadge" class="badge">ChÆ°a thiáº¿t láº­p</span>
      <button class="tog" id="btnChild" data-voice="Báº­t hoáº·c táº¯t cháº¿ Ä‘á»™ tá»± há»c">ğŸš¸ Tá»± há»c: Táº¯t</button>
      <button class="tog" id="btnVoice" data-voice="Báº­t hoáº·c táº¯t giá»ng nÃ³i trá»£ giÃºp">ğŸ”Š Giá»ng nÃ³i: Báº­t</button>
      <button class="ghost setup-only" id="btnSettings" data-voice="CÃ i Ä‘áº·t">CÃ i Ä‘áº·t</button>
      <button class="ghost" id="btnHelp" data-voice="HÆ°á»›ng dáº«n">HÆ°á»›ng dáº«n</button>
      <button class="ghost" id="btnTheme" data-voice="Äá»•i giao diá»‡n">ğŸŒˆ Giao diá»‡n</button>
    </div>
  </header>

  <!-- Thanh dá»… Ä‘á»c -->
  <section class="a11ybar">
    <button class="ghost" id="btnDys" data-voice="Báº­t táº¯t cháº¿ Ä‘á»™ dá»… Ä‘á»c">ğŸ‘â€ğŸ—¨ Dá»… Ä‘á»c: Táº¯t</button>
    <div class="spacer"></div>
    <div class="zoom">
      <button class="ghost" id="btnFontDown" aria-label="Giáº£m cá»¡ chá»¯" data-voice="Giáº£m cá»¡ chá»¯">Aâˆ’</button>
      <span id="fontPct">100%</span>
      <button class="ghost" id="btnFontUp" aria-label="TÄƒng cá»¡ chá»¯" data-voice="TÄƒng cá»¡ chá»¯">A+</button>
    </div>
    <button class="ghost" id="btnFocusLine" data-voice="Báº­t táº¯t con trá» Ä‘á»c theo dÃ²ng">ğŸ” Con trá»: Táº¯t</button>
  </section>

  <!-- HOME -->
  <section id="screen-home" class="screen active">
    <div class="hero home">
      <div class="hero-content">
        <h3 class="hero-title hero-title-fancy">ChÃ o má»«ng tá»›i Äá»c Dá»…</h3>
        <p class="hero-sub">á»¨ng dá»¥ng Structured Literacy: luyá»‡n Ã¢mâ€“chá»¯, Ä‘á»c trÃ´i cháº£y, hiá»ƒu ná»™i dung â€“ thÃ¢n thiá»‡n cho tráº» khÃ³ Ä‘á»c.</p>

        <div class="hero-badges">
          <span class="pill soft">Structured Literacy</span>
          <span class="pill soft">Voice UI</span>
          <span class="pill soft">TTS & Ghi Ã¢m</span>
          <span class="pill soft">Offline-first</span>
        </div>
      </div>

      <!-- Trang trÃ­ SVG: â€œwaveâ€ + bÃ³ng sÃ¡ch -->
      <svg class="hero-wave" viewBox="0 0 1000 280" preserveAspectRatio="none" aria-hidden="true">
        <defs>
          <linearGradient id="w1" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0" stop-color="#FFE0A3" stop-opacity="0.7"/>
            <stop offset="1" stop-color="#C7E4FF" stop-opacity="0.7"/>
          </linearGradient>
          <linearGradient id="w2" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0" stop-color="#FFD180" stop-opacity="0.55"/>
            <stop offset="1" stop-color="#B3E5FC" stop-opacity="0.55"/>
          </linearGradient>
        </defs>
        <path d="M0,180 C200,120 320,220 520,180 C720,140 820,220 1000,170 L1000,320 L0,320 Z" fill="url(#w1)"></path>
        <path d="M0,210 C160,170 300,250 520,210 C740,170 860,240 1000,210 L1000,320 L0,320 Z" fill="url(#w2)"></path>
      </svg>

      <div class="hero-art" id="art-home" aria-hidden="true"></div>
      <div class="hero-spark a"></div>
      <div class="hero-spark b"></div>
      <div class="hero-spark c"></div>
    </div>

    <!-- Quick actions -->
    <div class="home-quick">
      <button class="quick ghost" onclick="App.nav('assess'); AssessModule.init()" data-voice="ÄÃ¡nh giÃ¡ nhanh">ğŸ§ª ÄÃ¡nh giÃ¡</button>
      <button class="quick ghost" onclick="App.nav('pa')" data-voice="Luyá»‡n Ã¢m vá»‹">ğŸ¯ Ã‚m vá»‹</button>
      <button class="quick ghost" onclick="App.nav('cards')" data-voice="Tháº» tá»«">ğŸƒ Tháº» tá»«</button>
      <button class="quick ghost" onclick="App.nav('reading')" data-voice="Luyá»‡n Ä‘á»c">ğŸ“– Luyá»‡n Ä‘á»c</button>
      <button class="quick ghost" onclick="App.nav('game')" data-voice="TrÃ² chÆ¡i">ğŸ® TrÃ² chÆ¡i</button>
      <button class="quick ghost" onclick="App.nav('dashboard'); DashboardExtra.render()" data-voice="Dashboard">ğŸ“Š Dashboard</button>
    </div>

    <!-- Polaroid gallery: nhiá»u hÃ¬nh minh hoáº¡ báº±ng emoji -->
    <div class="home-gallery" aria-label="Minh hoáº¡ cÃ¡c hoáº¡t Ä‘á»™ng">
      <figure class="polaroid tilt-1">
        <div class="polaroid-img emoji-collage">
          <span>ğŸ“–</span><span>ğŸ”Š</span><span>ğŸ•’</span><span>âœï¸</span>
          <span>ğŸ§’</span><span>â­</span><span>ğŸ§ </span><span>ğŸ˜Š</span>
        </div>
        <figcaption>Äá»c trÃ´i cháº£y</figcaption>
      </figure>
      <figure class="polaroid tilt-2">
        <div class="polaroid-img emoji-collage">
          <span>ğŸ¯</span><span>ğŸ”¤</span><span>ğŸ‘‚</span><span>ğŸ—£ï¸</span>
          <span>ğŸµ</span><span>ğŸ§©</span><span>âœ¨</span><span>ğŸ‘</span>
        </div>
        <figcaption>Ã‚m vá»‹ â€“ ghÃ©p Ã¢m</figcaption>
      </figure>
      <figure class="polaroid tilt-3">
        <div class="polaroid-img emoji-collage">
          <span>ğŸƒ</span><span>ğŸ”</span><span>ğŸ—“ï¸</span><span>ğŸ†</span>
          <span>ğŸ’¡</span><span>ğŸ‘‚</span><span>ğŸ¢</span><span>ğŸ“ˆ</span>
        </div>
        <figcaption>Tháº» tá»« theo nhá»‹p</figcaption>
      </figure>
      <figure class="polaroid tilt-1">
        <div class="polaroid-img emoji-collage">
          <span>ğŸ§ª</span><span>ğŸ“Š</span><span>â±ï¸</span><span>ğŸ§®</span>
          <span>ğŸ“</span><span>ğŸ”</span><span>âœ…</span><span>ğŸ“</span>
        </div>
        <figcaption>ÄÃ¡nh giÃ¡ nhanh</figcaption>
      </figure>
      <figure class="polaroid tilt-2">
        <div class="polaroid-img emoji-collage">
          <span>ğŸˆ</span><span>ğŸ”Š</span><span>ğŸŒŸ</span><span>ğŸ¯</span>
          <span>ğŸ•¹ï¸</span><span>ğŸ˜º</span><span>ğŸ¶</span><span>ğŸ¥š</span>
        </div>
        <figcaption>TrÃ² chÆ¡i Ã¢m vá»‹</figcaption>
      </figure>
    </div>

    <!-- CÃ¡c tháº» tÃ­nh nÄƒng -->
    <div class="home-grid">
      <div class="card lift feature" data-variant="assess">
        <div class="f-head">
          <div class="f-icon">ğŸ§ª</div>
          <div class="f-title">
            <h3>ÄÃ¡nh giÃ¡ nhanh</h3>
            <div class="note">PA â€¢ RAN â€¢ Decoding â€¢ Sight. 7â€“10 phÃºt. LÆ°u káº¿t quáº£ Ä‘á»ƒ theo dÃµi.</div>
          </div>
        </div>
        <div class="inline-buttons">
          <button class="primary" onclick="App.nav('assess'); AssessModule.init()" data-voice="Má»Ÿ Ä‘Ã¡nh giÃ¡ nhanh">Báº¯t Ä‘áº§u</button>
          <button class="tts" onclick="App.speak('ÄÃ¡nh giÃ¡ nhanh')" data-voice="Nghe hÆ°á»›ng dáº«n ÄÃ¡nh giÃ¡ nhanh">ğŸ”Š Nghe</button>
        </div>
      </div>

      <div class="card lift feature" data-variant="pa">
        <div class="f-head">
          <div class="f-icon">ğŸ¯</div>
          <div class="f-title">
            <h3>Luyá»‡n Ã¢m vá»‹</h3>
            <div class="note">GhÃ©p Ã¢m â€“ thanh Ä‘iá»‡u â€“ cáº·p tá»‘i thiá»ƒu. NÃºt to, nghe trÆ°á»›c rá»“i chá»n.</div>
          </div>
        </div>
        <div class="inline-buttons">
          <button class="primary" onclick="App.nav('pa')" data-voice="Luyá»‡n Ã¢m vá»‹. Báº¯t Ä‘áº§u">Báº¯t Ä‘áº§u</button>
          <button class="tts" onclick="App.speak('Luyá»‡n Ã¢m vá»‹')" data-voice="Nghe hÆ°á»›ng dáº«n Luyá»‡n Ã¢m vá»‹">ğŸ”Š Nghe</button>
        </div>
      </div>

      <div class="card lift feature" data-variant="cards">
        <div class="f-head">
          <div class="f-icon">ğŸƒ</div>
          <div class="f-title">
            <h3>Tháº» tá»«</h3>
            <div class="note">Ã”n theo nhá»‹p. Cháº¡m â€œğŸ”Šâ€ Ä‘á»ƒ nghe. Chá»n Dá»…/Vá»«a/KhÃ³.</div>
          </div>
        </div>
        <div class="inline-buttons">
          <button class="primary" onclick="App.nav('cards')" data-voice="Tháº» tá»«. Ã”n táº­p">Ã”n táº­p</button>
        </div>
      </div>

      <div class="card lift feature" data-variant="reading">
        <div class="f-head">
          <div class="f-icon">ğŸ“–</div>
          <div class="f-title">
            <h3>Luyá»‡n Ä‘á»c</h3>
            <div class="note">B1 Chá»n â€¢ B2 Äá»c â€¢ B3 ÄÃ¡nh dáº¥u â€¢ B4 CÃ¢u há»i/Káº¿t quáº£.</div>
          </div>
        </div>
        <div class="inline-buttons">
          <button class="primary" onclick="App.nav('reading')" data-voice="Äá»c Ä‘oáº¡n. Luyá»‡n Ä‘á»c">Luyá»‡n Ä‘á»c</button>
        </div>
      </div>

      <div class="card lift feature" data-variant="game">
        <div class="f-head">
          <div class="f-icon">ğŸ®</div>
          <div class="f-title">
            <h3>TrÃ² chÆ¡i</h3>
            <div class="note">Xem â€œMá»¥c tiÃªuâ€, báº¥m â€œğŸ”Š Nghe máº«uâ€. BÃ³ng Ä‘Ãºng cÃ³ vÃ²ng sÃ¡ng.</div>
          </div>
        </div>
        <div class="inline-buttons">
          <button class="primary" onclick="App.nav('game')" data-voice="VÃ o trÃ² chÆ¡i">ChÆ¡i ngay</button>
          <button class="tts" onclick="App.speak('Trong trÃ² chÆ¡i, tÃ¬m Ä‘Ãºng theo má»¥c tiÃªu hiá»ƒn thá»‹. Báº¥m Nghe máº«u Ä‘á»ƒ nghe. BÃ³ng Ä‘Ãºng sáº½ cÃ³ vÃ²ng sÃ¡ng.')" data-voice="Nghe hÆ°á»›ng dáº«n trÃ² chÆ¡i">ğŸ”Š Nghe</button>
        </div>
      </div>

      <div class="card lift feature" data-variant="dashboard">
        <div class="f-head">
          <div class="f-icon">ğŸ“Š</div>
          <div class="f-title">
            <h3>Dashboard</h3>
            <div class="note">Tiáº¿n bá»™, lá»—i theo loáº¡i, xuáº¥t CSV/PDF, Ä‘á»“ng bá»™.</div>
          </div>
        </div>
        <div class="inline-buttons">
          <button class="primary" onclick="App.nav('dashboard'); DashboardExtra.render()" data-voice="Má»Ÿ báº£ng Ä‘iá»u khiá»ƒn">Má»Ÿ Dashboard</button>
        </div>
      </div>
    </div>

    <div class="section lift">
      <div class="row">
        <div class="level-pill">Gá»£i Ã½ cáº¥p Ä‘á»™ Ä‘á»c tiáº¿p theo: <b id="nextLevelHint">â€”</b></div>
        <div class="spacer"></div>
        <button onclick="App.nav('export')" data-voice="Xuáº¥t dá»¯ liá»‡u">Xuáº¥t dá»¯ liá»‡u</button>
      </div>
    </div>
  </section>

  <!-- PA -->
  <section id="screen-pa" class="screen">
    <div class="hero pa">
      <div class="hero-content">
        <h3 class="hero-title">Ã‚m vá»‹ há»c</h3>
        <p class="hero-sub">Nháº­n thá»©c Ã¢m vá»‹, Ã¢mâ€“chá»¯ hai chiá»u, cáº·p tá»‘i thiá»ƒu.</p>
      </div>
      <div class="hero-art" id="art-pa"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">Ã‚m vá»‹ há»c</span>
    </div>
    <div class="section lift" id="pa-container"></div>
    <div class="help">Máº¹o: Báº¥m â€œğŸ”Šâ€ Ä‘á»ƒ nghe; nÃºt to â€“ chá»n má»™t láº§n. Nháº¥n giá»¯ 0.4s Ä‘á»ƒ nghe tÃªn nÃºt.</div>
  </section>

  <!-- Cards -->
  <section id="screen-cards" class="screen">
    <div class="hero cards">
      <div class="hero-content">
        <h3 class="hero-title">Tháº» tá»«</h3>
        <p class="hero-sub">Ã”n theo nhá»‹p â€“ táº­p trung nhÃ³m lá»—i cÃ¡ nhÃ¢n.</p>
      </div>
      <div class="hero-art" id="art-cards"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">Tháº» tá»«</span>
    </div>

    <div class="section lift">
      <div class="row" style="gap:12px;">
        <label for="selCardTag" style="margin:0;">Chá»§ Ä‘á»/nhÃ³m lá»—i:</label>
        <select id="selCardTag" onchange="App.cards.setTag(this.value)" aria-label="Chá»n nhÃ³m tháº»"></select>
        <div class="spacer"></div>
        <button class="ghost" onclick="App.cards.reconcile()" data-voice="Cáº­p nháº­t tháº» má»›i theo dá»¯ liá»‡u">Cáº­p nháº­t tháº» má»›i</button>
        <span class="badge" id="cardStats">â€”</span>
      </div>
    </div>

    <div class="section lift" id="cards-container"></div>
    <div class="help">Cháº¡m â€œğŸ”Šâ€ Ä‘á»ƒ nghe rá»“i báº¥m Dá»…/Vá»«a/KhÃ³. á»¨ng dá»¥ng sáº½ tá»± háº¹n ngÃ y Ã´n.</div>
  </section>

  <!-- Assess (ÄÃ¡nh giÃ¡ nhanh) -->
  <section id="screen-assess" class="screen">
    <div class="hero assess">
      <div class="hero-content">
        <h3 class="hero-title">ÄÃ¡nh giÃ¡ nhanh</h3>
        <p class="hero-sub">PA â€¢ RAN â€¢ Decoding â€¢ Sight â€” 7â€“10 phÃºt. Evaluation â‰  Diagnosis (IDA).</p>
      </div>
      <div class="hero-art" id="art-assess"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">ÄÃ¡nh giÃ¡ nhanh (7â€“10 phÃºt)</span>
    </div>

    <div class="grid-2">
      <div class="section lift">
        <h3>PA â€“ Nháº­n thá»©c Ã¢m vá»‹ (cÃ¹ng váº§n)</h3>
        <div class="card list" id="paItems"></div>
        <div class="row" style="margin-top:8px;">
          <span class="stat">Äiá»ƒm: <b id="paScore">0/0</b></span>
          <div class="spacer"></div>
          <button class="ghost" onclick="AssessModule.resetPA()">LÃ m láº¡i</button>
        </div>
        <div class="muted" style="margin-top:6px;">Chá»n Ä‘Ã¡p Ã¡n cÃ³ váº§n giá»‘ng tá»« gá»£i Ã½.</div>
      </div>

      <div class="section lift">
        <h3>RAN â€“ Gá»i nhanh sá»‘ (50 má»¥c)</h3>
        <div class="mini-grid-5" id="ranGrid"></div>
        <div class="row" style="margin-top:8px;">
          <button class="primary" id="btnRanStart" onclick="AssessModule.startRAN()">Báº¯t Ä‘áº§u</button>
          <button class="ghost" id="btnRanStop" onclick="AssessModule.stopRAN()" disabled>Xong</button>
          <div class="spacer"></div>
          <span class="stat">â±ï¸ <b id="ranTime">â€”</b>s</span>
          <button class="ghost" onclick="AssessModule.shuffleRAN()">Äá»•i lÆ°á»›i</button>
        </div>
        <div class="muted" style="margin-top:6px;">Tráº» Ä‘á»c to láº§n lÆ°á»£t tá»« trÃ¡i sang pháº£i, trÃªn xuá»‘ng.</div>
      </div>

      <div class="section lift">
        <h3>Decoding â€“ Giáº£ tá»«</h3>
        <div class="card list" id="decList"></div>
        <div class="row" style="margin-top:8px;">
          <span class="stat">Äiá»ƒm: <b id="decScore">0/0</b></span>
          <div class="spacer"></div>
          <button class="ghost" onclick="AssessModule.resetDEC()">LÃ m láº¡i</button>
        </div>
        <div class="muted" style="margin-top:6px;">NgÆ°á»i Ä‘o Ä‘á»c giáº£ tá»«; náº¿u tráº» Ä‘á»c Ä‘Ãºng, tÃ­ch â€œÄÃºngâ€.</div>
      </div>

      <div class="section lift">
        <h3>Sight Words â€“ Tá»« chá»©c nÄƒng</h3>
        <div class="card list" id="sightList"></div>
        <div class="row" style="margin-top:8px;">
          <span class="stat">Äiá»ƒm: <b id="sightScore">0/0</b></span>
          <div class="spacer"></div>
          <button class="ghost" onclick="AssessModule.resetSIGHT()">LÃ m láº¡i</button>
        </div>
        <div class="muted" style="margin-top:6px;">Náº¿u tráº» nÃªu ngay (â‰¤2s) nghÄ©a/Ä‘á»c Ä‘Ãºng â†’ tÃ­ch â€œBiáº¿t ngayâ€.</div>
      </div>
    </div>

    <div class="section lift">
      <h3>Tá»•ng há»£p & LÆ°u</h3>
      <div class="row" style="gap:8px;">
        <span class="stat">PA: <b id="sumPA">â€”</b></span>
        <span class="stat">RAN: <b id="sumRAN">â€”</b> s</span>
        <span class="stat">Decoding: <b id="sumDEC">â€”</b></span>
        <span class="stat">Sight: <b id="sumSIGHT">â€”</b></span>
        <div class="spacer"></div>
        <button class="primary" onclick="AssessModule.save()">Ghi vÃ o nháº­t kÃ½</button>
      </div>
      <div class="help">ÄÃ¢y lÃ  â€œÄ‘Ã¡nh giÃ¡ nhanhâ€ ná»™i bá»™, khÃ´ng pháº£i cháº©n Ä‘oÃ¡n y khoa (IDA).</div>
    </div>
  </section>

  <!-- Reading -->
  <section id="screen-reading" class="screen">
    <div class="hero reading">
      <div class="hero-content">
        <h3 class="hero-title">Luyá»‡n Ä‘á»c 4 bÆ°á»›c</h3>
        <p class="hero-sub">B1 Chá»n â€¢ B2 Äá»c â€¢ B3 ÄÃ¡nh dáº¥u â€¢ B4 CÃ¢u há»i â€” kÃ¨m há»— trá»£ Spotlight/Pacer/Echo.</p>
      </div>
      <div class="hero-art" id="art-reading"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">Luyá»‡n Ä‘á»c (4 bÆ°á»›c)</span>
    </div>

    <div class="section lift">
      <div class="stepper" id="readSteps" role="tablist" aria-label="CÃ¡c bÆ°á»›c luyá»‡n Ä‘á»c">
        <div class="step active" data-step="1"><span>1</span> Chá»n</div>
        <div class="step" data-step="2"><span>2</span> Äá»c</div>
        <div class="step" data-step="3"><span>3</span> ÄÃ¡nh dáº¥u</div>
        <div class="step" data-step="4"><span>4</span> CÃ¢u há»i</div>
      </div>
    </div>

    <div class="section lift" id="readStep1">
      <div class="row" style="gap:12px;">
        <label for="selLevel" style="margin:0;">Cáº¥p Ä‘á»™:</label>
        <select id="selLevel" onchange="App.reading.chooseLevel(this.value)" aria-label="Chá»n cáº¥p Ä‘á»™"></select>

        <label for="selPassage" style="margin:0;">BÃ i:</label>
        <select id="selPassage" onchange="App.reading.choosePassage(this.value)" aria-label="Chá»n bÃ i Ä‘á»c"></select>
        <button class="ghost" onclick="App.reading.randomPassage()" data-voice="Chá»n bÃ i ngáº«u nhiÃªn">ğŸ”€ Ngáº«u nhiÃªn</button>

        <div class="spacer"></div>
        <div class="slider" data-voice="Äiá»u chá»‰nh tá»‘c Ä‘á»™ giá»ng Ä‘á»c">
          <span>ğŸ”Š Tá»‘c Ä‘á»™</span>
          <input id="rateSlider" type="range" min="0.6" max="1.4" step="0.05" value="0.9"
                 oninput="App.updateRateFromSlider(this.value)" />
          <span id="rateVal">0.90x</span>
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" onclick="App.reading.goStep(2)" data-voice="Sang bÆ°á»›c Ä‘á»c">Tiáº¿p tá»¥c</button>
      </div>
    </div>

    <div class="section lift" id="readStep2" style="display:none;">
      <div class="row">
        <button class="ghost" onclick="App.reading.goStep(1)" data-voice="Quay láº¡i bÆ°á»›c chá»n">â† Quay láº¡i</button>
        <div class="spacer"></div>
        <button class="primary" id="btnStartRead" onclick="App.reading.start()" data-voice="Báº¯t Ä‘áº§u Ä‘á»c vÃ  tÃ­nh giá»">Báº¯t Ä‘áº§u</button>
        <button id="btnStopRead" class="danger" onclick="App.reading.stop()" disabled data-voice="Káº¿t thÃºc bÃ i Ä‘á»c">Káº¿t thÃºc</button>
        <button class="tts" onclick="App.reading.speakPassage()" data-voice="Nghe toÃ n bá»™ Ä‘oáº¡n">ğŸ”Š Nghe Ä‘oáº¡n</button>
        <button class="record" id="btnRec" onclick="App.reading.toggleRec()" data-voice="Ghi Ã¢m giá»ng Ä‘á»c hoáº·c nghe láº¡i">Ghi Ã¢m</button>
      </div>
      <div class="row" style="gap:10px; margin-top:6px;">
        <span class="stat">â±ï¸ <span id="timer" role="timer" aria-live="off">00:00</span></span>
        <span class="stat">WCPM: <b id="statWCPM" aria-live="polite">â€”</b></span>
        <span class="stat">% Ä‘Ãºng: <b id="statAcc" aria-live="polite">â€”</b></span>
      </div>
      <div id="passageText" class="big-text reading-plain" aria-label="Äoáº¡n vÄƒn Ä‘á»ƒ Ä‘á»c" style="margin-top:8px;"></div>

      <div class="row" style="margin-top:10px;">
        <button class="ghost" onclick="App.reading.goStep(1)" data-voice="Quay láº¡i bÆ°á»›c chá»n">â† Quay láº¡i</button>
        <div class="spacer"></div>
        <button class="primary" onclick="App.reading.goStep(3)" data-voice="Sang bÆ°á»›c Ä‘Ã¡nh dáº¥u lá»—i">Sang bÆ°á»›c 3</button>
      </div>
    </div>

    <div class="section lift" id="readStep3" style="display:none;">
      <div class="row">
        <button class="ghost" onclick="App.reading.goStep(2)" data-voice="Quay láº¡i bÆ°á»›c Ä‘á»c">â† Quay láº¡i</button>
        <div class="spacer"></div>
        <button class="hint" onclick="App.reading.markMode('error')" id="btnErr" data-voice="Cháº¿ Ä‘á»™ Ä‘Ã¡nh dáº¥u lá»—i">ÄÃ¡nh dáº¥u lá»—i</button>
        <button class="ghost" onclick="App.reading.markMode('normal')" id="btnNorm" data-voice="Cháº¿ Ä‘á»™ bÃ¬nh thÆ°á»ng">Cháº¿ Ä‘á»™ bÃ¬nh thÆ°á»ng</button>
        <button class="ghost" onclick="App.reading.clearMarks()" data-voice="XÃ³a cÃ¡c dáº¥u lá»—i">ğŸ§¹ XÃ³a dáº¥u</button>
        <button class="primary" onclick="App.reading.goStep(4)" data-voice="Sang cÃ¢u há»i hiá»ƒu ná»™i dung">Sang bÆ°á»›c 4</button>
      </div>
      <div id="passageView" class="big-text" style="margin-top:10px;"></div>
      <div class="help">Cháº¡m vÃ o tá»« sai Ä‘á»ƒ Ä‘Ã¡nh dáº¥u; nháº¥n giá»¯ Ä‘á»ƒ chá»n loáº¡i lá»—i.</div>
    </div>

    <div id="readStep4" class="section lift" style="display:none;">
      <h3>CÃ¢u há»i hiá»ƒu ná»™i dung</h3>
      <div id="questions"></div>
      <div class="row" style="margin-top:8px;">
        <button class="ghost" onclick="App.reading.goStep(3)" data-voice="Quay láº¡i bÆ°á»›c Ä‘Ã¡nh dáº¥u">â† Quay láº¡i</button>
        <div class="spacer"></div>
        <button class="primary" onclick="App.reading.finishComp()" data-voice="Xem káº¿t quáº£">Xem káº¿t quáº£</button>
      </div>
    </div>
  </section>

  <!-- GAME -->
  <section id="screen-game" class="screen">
    <div class="hero game">
      <div class="hero-content">
        <h3 class="hero-title">TrÃ² chÆ¡i Ã¢m vá»‹</h3>
        <p class="hero-sub">Táº­p trung má»¥c tiÃªu: thanh Ä‘iá»‡u, nhÃ³m lá»—i, bÃ³ng cÃ³ vÃ²ng sÃ¡ng chá»‰ dáº«n.</p>
      </div>
      <div class="hero-art" id="art-game"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">TrÃ² chÆ¡i: BÃ³ng bay Ã¢m vá»‹</span>
    </div>

    <div class="section lift">
      <div class="row" style="gap:10px; align-items:center;">
        <div class="targetbox" id="gameTargetBox">
          <div><b>Má»¥c tiÃªu:</b> <span id="gameTargetText">â€”</span></div>
          <div class="inline-buttons" style="margin-top:6px;">
            <button class="tts" id="btnGameSample" data-voice="Nghe máº«u má»¥c tiÃªu">ğŸ”Š Nghe máº«u</button>
            <button class="ghost" id="btnGameExplain" data-voice="Giáº£i thÃ­ch má»¥c tiÃªu">â“ Giáº£i thÃ­ch</button>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="row" style="gap:8px;">
          <label style="margin:0;">Cháº¿ Ä‘á»™:</label>
          <select id="selGameMode" aria-label="Chá»n cháº¿ Ä‘á»™">
            <option value="tone">Theo thanh Ä‘iá»‡u</option>
            <option value="tag">Theo nhÃ³m lá»—i</option>
          </select>

          <span id="paneTone" class="row" style="gap:6px;">
            <label style="margin:0;">Thanh:</label>
            <select id="selGameTone" aria-label="Chá»n thanh">
              <option value="ngang">ngang</option>
              <option value="sáº¯c">sáº¯c</option>
              <option value="huyá»n">huyá»n</option>
              <option value="há»i">há»i</option>
              <option value="ngÃ£">ngÃ£</option>
              <option value="náº·ng">náº·ng</option>
            </select>
          </span>

          <span id="paneTag" class="row" style="gap:6px; display:none;">
            <label style="margin:0;">NhÃ³m:</label>
            <select id="selGameTag" aria-label="Chá»n nhÃ³m"></select>
          </span>
        </div>

        <div class="spacer"></div>

        <div class="row" style="gap:8px; align-items:center;">
          <span class="stat">ğŸ† Äiá»ƒm: <b id="gScore">0</b></span>
          <span class="stat">â±ï¸ <b id="gTime">60</b>s</span>
          <span class="stat">â¤ï¸ <b id="gLives">3</b></span>
          <button class="primary" id="btnGameStart" data-voice="Báº¯t Ä‘áº§u chÆ¡i">Báº¯t Ä‘áº§u</button>
          <button class="ghost" id="btnGameStop" disabled>Dá»«ng</button>
          <button class="ghost" id="btnGameTrain" data-voice="Báº­t cháº¿ Ä‘á»™ táº­p thá»­">ğŸ‘Ÿ Táº­p thá»­</button>
        </div>
      </div>
    </div>

    <div class="section lift">
      <canvas id="gameCanvas" width="900" height="420" aria-label="SÃ¢n chÆ¡i bÃ³ng bay"></canvas>
      <div class="help">Máº¹o: BÃ³ng Ä‘Ãºng cÃ³ <b>vÃ²ng sÃ¡ng</b> quanh bÃ³ng. Báº¥m Ä‘á»ƒ nghe tá»« rá»“i chá»n.</div>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="screen-dashboard" class="screen">
    <div class="hero dashboard">
      <div class="hero-content">
        <h3 class="hero-title">Dashboard</h3>
        <p class="hero-sub">Theo dÃµi WCPM, % Ä‘Ãºng, lá»—i, thá»i lÆ°á»£ng; kÃ¨m PA, RAN, Decoding, Sight.</p>
      </div>
      <div class="hero-art" id="art-dashboard"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">Dashboard</span>
    </div>

    <div class="grid-2">
      <div class="section lift">
        <h3>WCPM theo thá»i gian</h3>
        <canvas id="chartWCPM" width="600" height="260"></canvas>
      </div>
      <div class="section lift">
        <h3>% chÃ­nh xÃ¡c theo thá»i gian</h3>
        <canvas id="chartACC" width="600" height="260"></canvas>
      </div>
      <div class="section lift">
        <h3>Tá»•ng lá»—i theo loáº¡i</h3>
        <canvas id="chartERR" width="600" height="260"></canvas>
      </div>
      <div class="section lift">
        <h3>Thá»i lÆ°á»£ng luyá»‡n táº­p</h3>
        <canvas id="chartDUR" width="600" height="260"></canvas>
      </div>

      <div class="section lift">
        <h3>PA (tá»‰ lá»‡ Ä‘Ãºng)</h3>
        <canvas id="chartPA" width="600" height="260"></canvas>
      </div>
      <div class="section lift">
        <h3>RAN (giÃ¢y / 50 má»¥c)</h3>
        <canvas id="chartRAN" width="600" height="260"></canvas>
      </div>
      <div class="section lift">
        <h3>Decoding (tá»‰ lá»‡ Ä‘Ãºng)</h3>
        <canvas id="chartDEC" width="600" height="260"></canvas>
      </div>
      <div class="section lift">
        <h3>Sight Words (tá»‰ lá»‡ Ä‘Ãºng)</h3>
        <canvas id="chartSIGHT" width="600" height="260"></canvas>
      </div>
    </div>

    <div class="section lift">
      <div class="row">
        <button onclick="App.exportCSV()" data-voice="Táº£i tá»‡p CSV">Táº£i CSV</button>
        <button class="ghost" onclick="App.copyCSV()" data-voice="Sao chÃ©p CSV">Sao chÃ©p CSV</button>
        <div class="spacer"></div>
        <button class="danger" onclick="App.resetConfirm()" data-voice="XÃ³a dá»¯ liá»‡u trÃªn thiáº¿t bá»‹ nÃ y">XÃ³a dá»¯ liá»‡u (thiáº¿t bá»‹ nÃ y)</button>
      </div>
      <div class="help">CSV chá»‰ chá»©a mÃ£ áº©n danh cÃ¹ng cÃ¡c chá»‰ sá»‘ Ä‘Ã¡nh giÃ¡.</div>
    </div>

    <div class="section lift">
      <h3>Äá»“ng bá»™ Google Drive</h3>
      <div class="row">
        <div class="spacer"></div>
        <span class="badge" id="syncStatus">Tráº¡ng thÃ¡i: chÆ°a cáº¥u hÃ¬nh</span>
      </div>
      <div class="inline-buttons" style="margin-top:10px;">
        <button onclick="Sync.flush()" data-voice="Äá»“ng bá»™ dá»¯ liá»‡u ngay">Äá»“ng bá»™ ngay</button>
        <button class="ghost" onclick="App.testSync()" data-voice="Kiá»ƒm tra káº¿t ná»‘i Ä‘á»“ng bá»™">Kiá»ƒm tra káº¿t ná»‘i</button>
        <button class="ghost" onclick="App.showSyncHelp()" data-voice="HÆ°á»›ng dáº«n thiáº¿t láº­p Ä‘á»“ng bá»™">HÆ°á»›ng dáº«n thiáº¿t láº­p</button>
      </div>
      <div class="help">á»¨ng dá»¥ng gá»­i chá»‰ sá»‘ Ä‘á»c vÃ  Ä‘Ã¡nh giÃ¡ nhanh tá»›i Apps Script cá»§a báº¡n.</div>
    </div>
  </section>

  <!-- Export -->
  <section id="screen-export" class="screen">
    <div class="hero export">
      <div class="hero-content">
        <h3 class="hero-title">Xuáº¥t dá»¯ liá»‡u</h3>
        <p class="hero-sub">CSV nhanh; Evaluation Summary (PDF/CSV) Ä‘á»ƒ trao Ä‘á»•i vá»›i giÃ¡o viÃªn/SLP.</p>
      </div>
      <div class="hero-art" id="art-export"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">Xuáº¥t dá»¯ liá»‡u</span>
    </div>
    <div class="section lift">
      <div class="row">
        <button onclick="App.exportCSV()" data-voice="Táº£i tá»‡p CSV">Táº£i CSV</button>
        <button class="ghost" onclick="App.copyCSV()" data-voice="Sao chÃ©p CSV">Sao chÃ©p CSV</button>
        <div class="spacer"></div>
        <button class="primary" onclick="Report.exportPDF()" data-voice="Xuáº¥t báº£n tÃ³m táº¯t Ä‘Ã¡nh giÃ¡ dáº¡ng PDF">Evaluation Summary (PDF)</button>
        <button class="ghost" onclick="Report.exportCSV()" data-voice="Xuáº¥t báº£n tÃ³m táº¯t Ä‘Ã¡nh giÃ¡ dáº¡ng CSV">Evaluation Summary (CSV)</button>
      </div>
      <div class="help">Theo IDA: Evaluation â‰  Diagnosis â€” tÃ³m táº¯t há»c thuáº­t ná»™i bá»™, khÃ´ng pháº£i cháº©n Ä‘oÃ¡n y khoa.</div>
    </div>
  </section>

  <!-- Settings -->
  <section id="screen-settings" class="screen">
    <div class="hero settings">
      <div class="hero-content">
        <h3 class="hero-title">CÃ i Ä‘áº·t</h3>
        <p class="hero-sub">Há»“ sÆ¡ áº©n danh, font, tá»‘c Ä‘á»™ TTS, cáº¥p Ä‘á»™ khá»Ÿi Ä‘áº§uâ€¦</p>
      </div>
      <div class="hero-art" id="art-settings"></div>
    </div>

    <div class="row">
      <button onclick="App.nav('home')" data-voice="Vá» trang chÃ­nh">â† Vá» trang chÃ­nh</button>
      <div class="spacer"></div>
      <span class="badge">CÃ i Ä‘áº·t</span>
    </div>

    <div class="section lift">
      <h3>ThÃ´ng tin há»c viÃªn & á»©ng dá»¥ng</h3>
      <div class="grid-2">
        <div>
          <label>Há» vÃ  tÃªn (chá»‰ lÆ°u trÃªn mÃ¡y, khÃ´ng gá»­i Ä‘i)</label>
          <input type="text" id="inpName" placeholder="VD: Nguyá»…n A (tÃ¹y chá»n)"/>
        </div>
        <div>
          <label>MÃ£ há»‡ thá»‘ng (tá»± cáº¥p â€“ áº©n danh)</label>
          <input type="text" id="dispSysId" disabled />
        </div>
        <div>
          <label>Tuá»•i (khÃ´ng gá»­i Ä‘i)</label>
          <input type="number" id="inpAge" min="5" max="15" />
        </div>
        <div>
          <label>Khá»‘i/lá»›p (khÃ´ng gá»­i Ä‘i)</label>
          <input type="text" id="inpGrade" placeholder="VD: Lá»›p 2" />
        </div>
        <div>
          <label>PhÃ´ng chá»¯</label>
          <select id="selFont">
            <option>Lexend</option>
            <option>OpenDyslexic</option>
            <option selected>System Sans</option>
          </select>
        </div>
        <div>
          <label>Tá»‘c Ä‘á»™ TTS (0.6â€“1.4)</label>
          <input type="number" id="inpRate" value="0.9" step="0.05" min="0.6" max="1.4" />
        </div>
        <div>
          <label>Cáº¥p Ä‘á»™ Ä‘á»c ban Ä‘áº§u</label>
          <select id="selStartLevel"></select>
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" onclick="App.saveSettings()" data-voice="LÆ°u cÃ i Ä‘áº·t">LÆ°u</button>
      </div>
      <div class="help">á»¨ng dá»¥ng chá»‰ gá»­i cÃ¡c chá»‰ sá»‘ Ä‘Ã¡nh giÃ¡; Há» tÃªn/tuá»•i/lá»›p chá»‰ lÆ°u cá»¥c bá»™ Ä‘á»ƒ hiá»ƒn thá»‹.</div>
    </div>

    <div class="section lift">
      <h3>Äá»“ng bá»™ Google Drive</h3>
      <div class="grid-2">
        <div>
          <label>Äá»“ng bá»™ (Apps Script URL)</label>
          <input type="url" id="inpSyncUrl" placeholder="https://script.google.com/macros/s/XXX/exec" />
        </div>
        <div>
          <label>Máº­t mÃ£ bÃ­ máº­t (SECRET)</label>
          <input type="text" id="inpSyncSecret" placeholder="docde-secret-2025" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button onclick="App.saveSync()" data-voice="LÆ°u cÃ i Ä‘áº·t Ä‘á»“ng bá»™">LÆ°u Ä‘á»“ng bá»™</button>
        <button class="ghost" onclick="App.testSync()" data-voice="Kiá»ƒm tra káº¿t ná»‘i Ä‘á»“ng bá»™">Kiá»ƒm tra káº¿t ná»‘i</button>
      </div>
      <div class="help">DÃ¡n URL Web App tá»« Google Apps Script. SECRET pháº£i trÃ¹ng trong Script.</div>
    </div>
  </section>

  <!-- Help -->
  <div id="modalHelp" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="dialog">
      <h3 id="helpTitle">HÆ°á»›ng dáº«n nhanh (dá»… hiá»ƒu)</h3>
      <p class="muted">Má»—i ngÃ y 3 bÆ°á»›c ngáº¯n â€“ Ä‘á»u â€“ Ä‘Ãºng nhÃ³m lá»—i. DÃ¹ng emoji vÃ  mÃ u thanh Ä‘á»ƒ â€œngheâ€“nhÃ¬nâ€“nháº¥nâ€.</p>

      <div class="grid-2 help-steps" aria-label="BÆ°á»›c sá»­ dá»¥ng chÃ­nh">
        <div class="help-step">
          <div class="help-icon" aria-hidden="true">ğŸ¯</div>
          <div class="help-body">
            <b>1) Ã‚m vá»‹ (PA)</b>
            <ul>
              <li>Nghe máº«u <b>ğŸ”Š</b> hoáº·c <b>ğŸ¢</b>, rá»“i ghÃ©p Ä‘Ãºng onsetâ€“váº§n hoáº·c chá»n Ä‘Ãºng thanh.</li>
              <li>LÃ m quen 6 thanh:
                <span class="tone-pill tone-ngang">ngang</span>
                <span class="tone-pill tone-sac">sáº¯c</span>
                <span class="tone-pill tone-huyen">huyá»n</span>
                <span class="tone-pill tone-hoi">há»i</span>
                <span class="tone-pill tone-nga">ngÃ£</span>
                <span class="tone-pill tone-nang">náº·ng</span>
              </li>
              <li>5â€“7 phÃºt, 6â€“8 má»¥c tiÃªu.</li>
            </ul>
          </div>
        </div>
        <div class="help-step">
          <div class="help-icon" aria-hidden="true">ğŸƒ</div>
          <div class="help-body">
            <b>2) Tháº» tá»« (Cards)</b>
            <ul>
              <li>Ã”n 4â€“7 phÃºt, Æ°u tiÃªn tháº» Ä‘áº¿n háº¡n theo tag (s/x, ch/tr, toneâ€¦).</li>
              <li>Má»—i tháº»: ğŸ”Š/ğŸ¢ â†’ chá»n Dá»…/Vá»«a/KhÃ³ Ä‘á»ƒ há»‡ thá»‘ng háº¹n ngÃ y Ã´n.</li>
            </ul>
          </div>
        </div>
        <div class="help-step">
          <div class="help-icon" aria-hidden="true">ğŸ“–</div>
          <div class="help-body">
            <b>3) Luyá»‡n Ä‘á»c (4 bÆ°á»›c)</b>
            <ul>
              <li>B1 Chá»n â€¢ B2 Äá»c â€¢ B3 ÄÃ¡nh dáº¥u â€¢ B4 CÃ¢u há»i/Káº¿t quáº£.</li>
              <li>Gá»£i Ã½: báº­t â€œğŸ” Con trá»â€ Ä‘á»ƒ táº­p trung theo dÃ²ng.</li>
            </ul>
          </div>
        </div>
        <div class="help-step">
          <div class="help-icon" aria-hidden="true">ğŸ§ª</div>
          <div class="help-body">
            <b>ÄÃ¡nh giÃ¡ nhanh & TrÃ² chÆ¡i</b>
            <ul>
              <li>ÄÃ¡nh giÃ¡: PA â€¢ RAN â€¢ Decoding â€¢ Sight (7â€“10 phÃºt).</li>
              <li>TrÃ² chÆ¡i Ã¢m vá»‹: xem â€œMá»¥c tiÃªuâ€, báº¥m ğŸ”Š Nghe máº«u.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:8px;">
        <div class="spacer"></div>
        <button onclick="document.getElementById('modalHelp').classList.remove('active')" data-voice="ÄÃ³ng hÆ°á»›ng dáº«n">ÄÃ£ hiá»ƒu</button>
      </div>
    </div>
  </div>

  <!-- Onboarding -->
  <div id="modalOnboard" class="modal" role="dialog" aria-modal="true" aria-labelledby="obTitle">
    <div class="dialog">
      <h3 id="obTitle">Thiáº¿t láº­p nhanh</h3>
      <div class="grid-2">
        <div>
          <label>Há» vÃ  tÃªn (chá»‰ lÆ°u trÃªn mÃ¡y)</label>
          <input type="text" id="obName" placeholder="VD: Nguyá»…n A"/>
        </div>
        <div>
          <label>Tuá»•i (khÃ´ng gá»­i Ä‘i)</label>
          <input type="number" id="obAge" min="5" max="15"/>
        </div>
        <div>
          <label>Khá»‘i/lá»›p (khÃ´ng gá»­i Ä‘i)</label>
          <input type="text" id="obGrade" placeholder="VD: Lá»›p 2"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" onclick="App.finishOnboard()" data-voice="Báº¯t Ä‘áº§u sá»­ dá»¥ng">Báº¯t Ä‘áº§u</button>
      </div>
      <div class="help">á»¨ng dá»¥ng tá»± cáº¥p mÃ£ áº©n danh vÃ  chá»‰ gá»­i cÃ¡c chá»‰ sá»‘ Ä‘Ã¡nh giÃ¡. Há» tÃªn chá»‰ lÆ°u trÃªn mÃ¡y.</div>
    </div>
  </div>

  <!-- Menu lá»—i Ä‘Ã¡nh dáº¥u -->
  <div id="errorMenu" class="modal" style="background: transparent;" role="dialog" aria-modal="true" aria-labelledby="errTitle">
    <div class="dialog" style="max-width:380px;">
      <h3 id="errTitle">Chá»n loáº¡i lá»—i</h3>
      <div class="row" style="flex-wrap: wrap;">
        <button onclick="App.reading.setErrType('tone')" data-voice="Sai thanh Ä‘iá»‡u">Sai thanh Ä‘iá»‡u</button>
        <button onclick="App.reading.setErrType('sx')" data-voice="Nháº§m s vÃ  x">Nháº§m s x</button>
        <button onclick="App.reading.setErrType('chtr')" data-voice="Nháº§m ch vÃ  tr">Nháº§m ch tr</button>
        <button onclick="App.reading.setErrType('omission')" data-voice="Bá» Ã¢m hoáº·c bá» tá»«">Bá» Ã¢m</button>
        <button onclick="App.reading.setErrType('insertion')" data-voice="ThÃªm Ã¢m hoáº·c thÃªm tá»«">ThÃªm Ã¢m</button>
        <button onclick="App.reading.setErrType('other')" data-voice="Lá»—i khÃ¡c">KhÃ¡c</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <div class="spacer"></div>
        <button class="ghost" onclick="document.getElementById('errorMenu').classList.remove('active')" data-voice="ÄÃ³ng báº£ng chá»n lá»—i">ÄÃ³ng</button>
      </div>
    </div>
  </div>

  <!-- KhÃ³a/thoÃ¡t Child Mode -->
  <div class="lockbar" id="lockbar" style="display:none;">
    <span>ğŸš¸ Tá»± há»c Ä‘ang báº­t</span>
    <button class="ghost" id="btnUnlock" data-voice="Giá»¯ 3 giÃ¢y Ä‘á»ƒ thoÃ¡t tá»± há»c">Giá»¯ 3s Ä‘á»ƒ thoÃ¡t</button>
  </div>

</div>

<div id="fxLayer" class="fx-layer" aria-hidden="true"></div>

<div class="footerbar" id="footerbar">
  <button onclick="App.nav('home')" data-voice="Trang chÃ­nh" aria-current="page">Trang chÃ­nh</button>
  <button onclick="App.nav('assess'); AssessModule.init()" data-voice="ÄÃ¡nh giÃ¡ nhanh">ÄÃ¡nh giÃ¡</button>
  <button onclick="App.nav('pa')" data-voice="Ã‚m vá»‹">Ã‚m vá»‹</button>
  <button onclick="App.nav('reading')" data-voice="Äá»c Ä‘oáº¡n">Äá»c Ä‘oáº¡n</button>
  <button onclick="App.nav('game')" data-voice="TrÃ² chÆ¡i">TrÃ² chÆ¡i</button>
  <button onclick="App.nav('dashboard'); DashboardExtra.render()" data-voice="Báº£ng Ä‘iá»u khiá»ƒn">Dashboard</button>
</div>

<!-- Scripts -->
<script src="./app/data.js" defer></script>
<script src="./app/store.js" defer></script>
<script src="./app/tts.js" defer></script>
<script src="./app/voiceui.js" defer></script>
<script src="./app/recorder.js" defer></script>
<script src="./app/coach.js" defer></script>
<script src="./app/utils.js" defer></script>
<script src="./app/charts.js" defer></script>
<script src="./app/adaptive.js" defer></script>
<script src="./app/sr.js" defer></script>
<script src="./app/sync.js" defer></script>

<script src="./app/modules/pa.js" defer></script>
<script src="./app/modules/cards.js" defer></script>
<script src="./app/modules/reading.js" defer></script>
<script src="./app/modules/dashboard.js" defer></script>
<script src="./app/modules/game.js" defer></script>

<script src="./app/modules/assess.js" defer></script>
<script src="./app/modules/dashboard_extra.js" defer></script>
<script src="./app/modules/report.js" defer></script>
<script src="./app/modules/illustrations.js" defer></script>
<script src="./app/effects.js" defer></script>
<script src="./app/a11y.js" defer></script>
<script src="./app/app.js" defer></script>
<script src="./app/xplat_patch.js" defer></script>
<script src="./app/criteria_enforce.js" defer></script>

<!-- VÃ¡: Chá»‰ nÃ³i 1 láº§n/ thao tÃ¡c + Tá»± áº©n thanh Ä‘Ã¡y + Thu gá»n/hiá»‡n appbar & a11ybar -->
<script>
  window.addEventListener('load', function(){
    /* 1) NÃ³i 1 láº§n/1 thao tÃ¡c Ä‘á»ƒ trÃ¡nh láº·p gÃ¢y phÃ¢n tÃ¢m */
    (function speakOnce(){
      const last = { t: 0, txt: '' }, gap = 1200;
      function isDup(text){ const now=Date.now(); if(text && text===last.txt && (now-last.t)<gap){ return true; } last.txt=text||''; last.t=now; return false; }
      if (window.VoiceUI){
        const orig = VoiceUI.say ? VoiceUI.say.bind(VoiceUI) : null;
        VoiceUI.say = function(text){ if(!text || isDup(text)) return; try{ orig? orig(text) : (window.TTS && TTS.speak && TTS.speak(text)); }catch(_){} };
      }
      if (window.App){
        const o = App.speak ? App.speak.bind(App) : null;
        App.speak = function(text, rate){ if(!text || isDup(text)) return; try{ o? o(text, rate) : (window.TTS && TTS.speak && TTS.speak(text, rate)); }catch(_){} };
      }
      document.addEventListener('click', function(e){
        const el = e.target.closest('[data-voice]'); if (!el) return;
        const msg = el.getAttribute('data-voice'); if (!msg || isDup(msg)) e.stopPropagation();
      }, true);
    })();

    /* 2) Tá»± áº©n thanh Ä‘Ã¡y Ä‘á»ƒ khÃ´ng che ná»™i dung; hiá»‡n khi cháº¡m mÃ©p dÆ°á»›i */
    (function autoHideFooter(){
      const bar = document.getElementById('footerbar'); if (!bar) return;
      let hideTimer = null;
      function hide(){ bar.classList.add('hidden'); }
      function show(){ bar.classList.remove('hidden'); clearTimeout(hideTimer); hideTimer=setTimeout(hide, 2500); }
      setTimeout(hide, 1500);
      const nearBottom = y => (window.innerHeight - y) < 80;
      window.addEventListener('touchstart', e=>{ const y=e.touches[0]?.clientY||0; if (nearBottom(y)) show(); }, {passive:true});
      window.addEventListener('mousemove', e=>{ if (nearBottom(e.clientY)) show(); }, {passive:true});
      bar.addEventListener('focusin', show);
      bar.addEventListener('focusout', ()=> setTimeout(hide, 800));
      const nav = window.App && App.nav ? App.nav.bind(App) : null;
      if (nav){ App.nav = function(scr){ const r=nav(scr); setTimeout(hide, 1200); return r; }; }
    })();

    /* 3) Thu gá»n/hiá»‡n thanh tiÃªu Ä‘á» (appbar) theo nÃºt */
    (function headerToggle(){
      const header = document.querySelector('.appbar');
      const btn = document.getElementById('btnHeaderToggle');
      if (!header || !btn) return;
      function setState(hidden){
        header.classList.toggle('hidden-appbar', hidden);
        btn.setAttribute('aria-pressed', hidden? 'true':'false');
        btn.textContent = hidden ? 'â¬‡ Hiá»‡n tiÃªu Ä‘á»' : 'â¬† Thu gá»n';
        localStorage.setItem('hideAppbar', hidden ? '1' : '0');
      }
      try{ setState(localStorage.getItem('hideAppbar') === '1'); }catch(_){}
      btn.addEventListener('click', ()=> setState(!header.classList.contains('hidden-appbar')));
    })();

    /* 4) Thu gá»n/hiá»‡n thanh há»— trá»£ (a11ybar: Dá»… Ä‘á»c/A-/A+/Con trá») theo nÃºt */
    (function a11yToggle(){
      const bar = document.querySelector('.a11ybar');
      const btn = document.getElementById('btnA11yToggle');
      if (!bar || !btn) return;
      function setState(hidden){
        bar.classList.toggle('hidden-a11ybar', hidden);
        btn.setAttribute('aria-pressed', hidden? 'true':'false');
        btn.textContent = hidden ? 'ğŸ›  Hiá»‡n há»— trá»£' : 'ğŸ›  Thu gá»n há»— trá»£';
        localStorage.setItem('hideA11ybar', hidden ? '1' : '0');
      }
      try{ setState(localStorage.getItem('hideA11ybar') === '1'); }catch(_){}
      btn.addEventListener('click', ()=> setState(!bar.classList.contains('hidden-a11ybar')));
    })();
  });
</script>

<noscript>á»¨ng dá»¥ng cáº§n JavaScript Ä‘á»ƒ hoáº¡t Ä‘á»™ng.</noscript>
</body>
</html>